<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Workflow API Development Tutorial &#8212; Xi-cam 1.2.2 documentation</title>
    
    <link rel="stylesheet" href="_static/graphite.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="Xi-cam 1.2.2 documentation" href="index.html" />
    <link rel="prev" title="Plugin Development Tutorial" href="pluginTutorial.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="pluginTutorial.html" title="Plugin Development Tutorial"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Xi-cam 1.2.2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="workflow-api-development-tutorial">
<h1>Workflow API Development Tutorial<a class="headerlink" href="#workflow-api-development-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-the-workflow-api">
<h2>What is the Workflow API?<a class="headerlink" href="#what-is-the-workflow-api" title="Permalink to this headline">¶</a></h2>
<p>The Xi-cam workflow API allows users to add their own functions into the Xi-cam processing environment. With only casual
experience in Python and no knowledge of Qt, you can give your custom analysis or processing technique an accessible
user interface. The benefits of this approach can include:</p>
<ul class="simple">
<li>Community exposure of your analysis technique</li>
<li>Rapid GUI integration</li>
<li>Explore results/output with Xi-cam&#8217;s visualization tools</li>
<li>Integration with remote data interfaces (SFTP, SPOT, Globus)</li>
<li>Seamless execution of your function/workflow locally or remotely</li>
</ul>
</div>
<div class="section" id="how-does-it-work">
<h2>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h2>
<p>To develop a function for use in the workflow &#8216;User/Developers&#8217; must provide 2 things:</p>
<ul class="simple">
<li>A dictionary defining a reference to the function and parameters which can be set in the dynamic interface</li>
<li>The function, which must follow guidelines for its signature and output</li>
</ul>
<p>Here is an example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">RickerWaveletCenterFind</span><span class="p">(</span><span class="n">minr</span><span class="p">,</span> <span class="n">maxr</span><span class="p">,</span> <span class="o">**</span><span class="n">workspace</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function takes two user-configurable parameters: minr and maxr.</span>
<span class="sd">        The workspace kwargs is passed along through each step of the workflow</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
        <span class="kn">from</span> <span class="nn">pipeline</span> <span class="kn">import</span> <span class="n">center_approx</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
        <span class="kn">from</span> <span class="nn">xicam</span> <span class="kn">import</span> <span class="n">config</span>

        <span class="c1"># The function pulls data out of the workspace</span>
        <span class="n">rawdata</span> <span class="o">=</span> <span class="n">workspace</span><span class="p">[</span><span class="s1">&#39;dimg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rawdata</span>

        <span class="c1"># ...and does some math...</span>
        <span class="n">radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minr</span><span class="p">,</span> <span class="n">maxr</span><span class="p">)</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radii</span><span class="p">)):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">center_approx</span><span class="o">.</span><span class="n">tophat2</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">im2</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">im2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">maxval</span><span class="p">:</span>
                <span class="n">maxval</span> <span class="o">=</span> <span class="n">im2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">im2</span><span class="o">.</span><span class="n">argmax</span><span class="p">(),</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="c1"># In this case, it modifies the global calibration parameters...</span>
        <span class="n">config</span><span class="o">.</span><span class="n">activeExperiment</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>

        <span class="c1"># ...but also adds to the workflow workspace</span>
        <span class="n">updates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">center</span><span class="p">}</span>

        <span class="c1"># This function just merges the two dictionaries together; updates have preference</span>
        <span class="n">workspace</span> <span class="o">=</span> <span class="n">updateworkspace</span><span class="p">(</span><span class="n">workspace</span><span class="p">,</span> <span class="n">updates</span><span class="p">)</span>

        <span class="c1"># This function&#39;s changes (&#39;updates&#39;) and the updated workspace are both returned</span>
        <span class="k">return</span> <span class="n">workspace</span><span class="p">,</span> <span class="n">updates</span>
</pre></div>
</td></tr></table></div>
<p>A block of YAML markup is used to provide a reference to this function and how it is exposed:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">functionManifest</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Center Finding:</span>
<span class="s2">        - displayName:  Ricker Wavelets</span>
<span class="s2">          functionName: RickerWaveletCenterFind</span>
<span class="s2">          moduleName:   saxsfunctions</span>
<span class="s2">          functionType: PROCESS</span>
<span class="s2">          parameters:</span>
<span class="s2">              - name:   Search minimum</span>
<span class="s2">                type:   int</span>
<span class="s2">                limits: [1,100000]</span>
<span class="s2">                suffix: &#39; px&#39;</span>
<span class="s2">              - name:   Search maximum</span>
<span class="s2">                type:   int</span>
<span class="s2">                limits: [1,100000]</span>
<span class="s2">                suffix: &#39; px&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
<p>A workflow module must contain a <code class="docutils literal"><span class="pre">functionManifest</span></code> which describes its contents. The &#8216;parameters&#8217; block is a list of
dictionary objects which can be read using PyQtGraph&#8217;s Parameter.create() method
(see <a class="reference external" href="http://www.pyqtgraph.org/documentation/parametertree/parametertypes.html">PyQtGraph API</a>).</p>
</div>
<div class="section" id="function-types">
<h2>Function Types<a class="headerlink" href="#function-types" title="Permalink to this headline">¶</a></h2>
<p>There are 4 categories of workflow functions. These function categories have slightly unique signatures:</p>
<div class="section" id="input">
<h3>INPUT<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h3>
<p>The function adds data into the workflow.
Example signature:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">function</span><span class="p">([</span><span class="n">userArg1</span><span class="p">,</span> <span class="n">userArg2</span><span class="p">,</span> <span class="o">...</span><span class="p">,]</span> <span class="o">**</span><span class="n">workspace</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">workspace</span><span class="p">,</span> <span class="n">updates</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="output">
<h3>OUTPUT<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>The function writes data to file, remote resource, or database. These functions should operate on the <code class="docutils literal"><span class="pre">updates</span></code>
dictionary argument. These functions return no values.
Example signature:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">function</span><span class="p">([</span><span class="n">userArg1</span><span class="p">,</span> <span class="n">userArg2</span><span class="p">,</span> <span class="o">...</span><span class="p">,]</span> <span class="n">updates</span><span class="p">,</span> <span class="o">**</span><span class="n">workspace</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="c1"># No return value</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="process">
<h3>PROCESS<a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h3>
<p>The function performs processing/analysis and adds its result to the workspace.
Example signature:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">function</span><span class="p">([</span><span class="n">userArg1</span><span class="p">,</span> <span class="n">userArg2</span><span class="p">,</span> <span class="o">...</span><span class="p">,]</span> <span class="o">**</span><span class="n">workspace</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">workspace</span><span class="p">,</span> <span class="n">updates</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="visualize">
<h3>VISUALIZE<a class="headerlink" href="#visualize" title="Permalink to this headline">¶</a></h3>
<p>The function builds a Qt visualization from the data in <code class="docutils literal"><span class="pre">workspace</span></code>. These functions return a QWidget class and
a <code class="docutils literal"><span class="pre">tuple</span></code> of the class arguments to be used with its construction.
Example signature:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">function</span><span class="p">([</span><span class="n">userArg1</span><span class="p">,</span> <span class="n">userArg2</span><span class="p">,</span> <span class="o">...</span><span class="p">,]</span> <span class="n">updates</span><span class="p">,</span> <span class="o">**</span><span class="n">workspace</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">QWidgetClass</span><span class="p">,</span> <span class="p">(</span><span class="n">widgetArg1</span><span class="p">,</span> <span class="n">widgetArg2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Workflow API Development Tutorial</a><ul>
<li><a class="reference internal" href="#what-is-the-workflow-api">What is the Workflow API?</a></li>
<li><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
<li><a class="reference internal" href="#function-types">Function Types</a><ul>
<li><a class="reference internal" href="#input">INPUT</a></li>
<li><a class="reference internal" href="#output">OUTPUT</a></li>
<li><a class="reference internal" href="#process">PROCESS</a></li>
<li><a class="reference internal" href="#visualize">VISUALIZE</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pluginTutorial.html"
                        title="previous chapter">Plugin Development Tutorial</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/workflowAPI.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="pluginTutorial.html" title="Plugin Development Tutorial"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Xi-cam 1.2.2 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Pandolfi, R., Kumar, D., Venkatakrishnan, S., Krishnan, H., Hexemer, A..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>